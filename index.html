<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BTV Dashboard - Casus 5: Amsterdam</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, serverTimestamp, collection, addDoc, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBRq1HFmhrpW_EMMZwpURrbTArz-L5iWT4",
            authDomain: "pvaangifteinleveren-77dbe.firebaseapp.com",
            projectId: "pvaangifteinleveren-77dbe",
            storageBucket: "pvaangifteinleveren-77dbe.firebasestorage.app",
            messagingSenderId: "20239054410",
            appId: "1:20239054410:web:264b3c759312248d9f18b3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.startLes = () => {
            const naam = document.getElementById('uNaam').value.trim();
            const klas = document.getElementById('uKlas').value;
            if(!naam || !klas) return alert("Vul voornaam en eenheid in.");
            document.getElementById('loginOverlay').style.display='none';
            document.getElementById('mainContent').classList.remove('hidden');
            document.getElementById('displayKlas').innerText = klas;
            initLive(klas);
        };

        window.speakWitness = () => {
            const text = document.getElementById('witnessText').innerText;
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'nl-NL';
            msg.pitch = 0.9;
            msg.rate = 0.9;
            window.speechSynthesis.speak(msg);
        };

        async function initLive(klas) {
            const q = query(collection(db, "btv_2026"), where("klas", "==", klas), orderBy("ts", "desc"));
            onSnapshot(q, (sn) => {
                const feed = document.getElementById('liveFeed');
                feed.innerHTML = "";
                sn.forEach(d => {
                    const data = d.data();
                    const card = `
                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-4">
                            <div class="bg-slate-100 px-4 py-2 border-b flex justify-between items-center text-[10px]">
                                <span class="font-black text-blue-900 uppercase">${data.naam}</span>
                                <span class="bg-blue-900 text-white px-2 py-0.5 rounded-full font-bold uppercase">${data.type}</span>
                            </div>
                            <div class="p-4 text-sm italic text-slate-700 leading-relaxed whitespace-pre-wrap">"${data.txt}"</div>
                        </div>`;
                    feed.innerHTML += card;
                });
            });
        }

        window.sendData = async (type, elementId) => {
            const txt = document.getElementById(elementId).value;
            const naam = document.getElementById('uNaam').value;
            const klas = document.getElementById('uKlas').value;
            if(!txt) return alert("Veld is leeg.");
            
            await addDoc(collection(db, "btv_2026"), { 
                naam, klas, type, txt, ts: serverTimestamp()
            });

            if(type === 'PV Bevindingen') {
                alert("SYSTEEMMELDING: Dienstoverdracht voltooid. Uw PV Bevindingen zijn succesvol verwerkt in de livefeed.");
            } else {
                alert(type + " is succesvol verzonden.");
            }
        };
    </script>

    <style>
        .bg-police { background-color: #002d5e; }
        .text-police { color: #002d5e; }
        .border-police { border-color: #002d5e; }
    </style>
</head>
<body class="bg-slate-100 font-sans pb-20">

    <div id="loginOverlay" class="fixed inset-0 bg-police z-50 flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md border-t-8 border-yellow-500">
            <h1 class="font-black text-2xl mb-2 text-police uppercase italic tracking-tight text-center">Inloggen NATO</h1>
            <p class="text-[10px] text-slate-500 mb-6 font-bold uppercase text-center">Kwartier 2 - Casus 5</p>
            <input type="text" id="uNaam" placeholder="Voornaam" class="w-full border-2 p-4 rounded-xl mb-4 font-bold text-center focus:border-blue-500 outline-none">
            <select id="uKlas" class="w-full border-2 p-4 rounded-xl mb-8 font-bold text-center focus:border-blue-500 outline-none">
                <option value="">-- Kies Eenheid --</option>
                <option>Delta</option><option>Echo</option><option>Foxtrot</option><option>Lima</option><option>Mike</option>
            </select>
            <button onclick="startLes()" class="w-full bg-police text-white p-5 rounded-xl font-black uppercase tracking-widest hover:bg-blue-900 transition-colors">Log in</button>
        </div>
    </div>

    <div id="mainContent" class="hidden max-w-5xl mx-auto p-4 space-y-8">
        
        <header class="bg-police text-white p-6 rounded-2xl shadow-xl flex justify-between items-center border-b-4 border-yellow-500">
            <div>
                <h1 class="font-black italic uppercase text-xl italic">BTV DASHBOARD 2026</h1>
                <p class="text-[10px] text-yellow-400 font-bold uppercase tracking-widest leading-none">Eenheid: <span id="displayKlas"></span></p>
            </div>
        </header>

        <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
            <h2 class="font-black uppercase text-xs text-police mb-4 border-b pb-2">Casus Informatie</h2>
            <div class="space-y-4 text-sm leading-relaxed text-slate-700 italic">
                De Dapperstraat is gedurende de dagmarkt van 06.00 en 19.00 uur een voetgangersgebied. De Eerste van Swindenstraat is een drukke winkelstraat binnen de bebouwde kom van Amsterdam en loopt dwars door het marktgebied. Max snelheid: 30 km/u.
                <p class="bg-red-50 p-4 rounded-xl border-l-4 border-red-500 not-italic font-bold">
                    Een man ligt zwaargewond op de VOP. Veel bloed aan rechterbeen. Hij is traag van begrip. Een zwarte VW Golf staat op het kruisingsvlak.
                </p>
            </div>
        </section>

        <section class="bg-yellow-50 border-2 border-yellow-400 p-6 rounded-2xl shadow-sm">
            <h2 class="font-black uppercase text-sm mb-4 text-yellow-900 italic">Stap 1: Stel een DAA op</h2>
            <textarea id="daaInput" class="w-full border-2 border-yellow-200 p-4 rounded-xl text-sm h-32 mb-4 outline-none focus:border-yellow-500 shadow-inner" placeholder="Focus op Doel, Aanpak en Analyse..."></textarea>
            <button onclick="sendData('DAA', 'daaInput')" class="w-full bg-yellow-600 text-white py-3 rounded-xl font-black uppercase text-xs">Verstuur DAA naar livefeed</button>
        </section>

        <section class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <img src="casus530kmuur.png" class="w-full h-32 object-cover rounded-xl border-2 border-white shadow-md bg-slate-200">
            <img src="casus5luchtfoto.png" class="w-full h-32 object-cover rounded-xl border-2 border-white shadow-md bg-slate-200">
            <img src="casus5streetview.png" class="w-full h-32 object-cover rounded-xl border-2 border-white shadow-md bg-slate-200">
            <img src="casus5terplaatse.png" class="w-full h-32 object-cover rounded-xl border-2 border-white shadow-md bg-slate-200">
        </section>

        <section class="bg-white p-6 rounded-2xl shadow-md border border-slate-200">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h2 class="font-black uppercase text-sm text-police">Getuigenverklaring</h2>
                <button onclick="speakWitness()" class="bg-blue-600 hover:bg-blue-800 text-white px-3 py-1 rounded-full text-[10px] font-black uppercase transition-all">Luister naar verklaring</button>
            </div>
            <p id="witnessText" class="italic text-sm text-slate-700 leading-relaxed bg-slate-50 p-4 rounded-xl border border-slate-100">
                Ik liep zojuist over de Dapperstraat en wilde de Eerste van Swindenstraat via de voetgangersoversteekplaats oversteken. Ongeveer vijf meter voor mij liep een man. Ik zag dat hij inmiddels de voetgangersoversteekplaats was opgelopen. Tegelijkertijd zag ik een zwarte Volkswagen Golf met hoge snelheid aan komen rijden uit de richting van de Pontanusstraat. De bestuurder minderde geen vaart en reed de man vol aan. De man werd door deze aanrijding tegen het wegdek geworpen en bleef gewond liggen. Ik heb vervolgens direct de politie gebeld.
            </p>
        </section>

        <section class="bg-white p-8 rounded-3xl shadow-2xl border-t-8 border-police space-y-6">
            <h2 class="font-black uppercase text-xl text-police italic tracking-tighter">Stap 2: PV van Bevindingen</h2>
            
            <div class="bg-blue-900 text-white p-5 rounded-2xl">
                <h3 class="font-black uppercase text-[10px] mb-3 text-yellow-400 tracking-widest">Nieuwe Sporen PD (VOA):</h3>
                <ul class="text-[11px] font-bold space-y-2 opacity-90">
                    <li>Spoor 1: Een remsleep van ca. 12 meter op het asfalt.</li>
                    <li>Spoor 2: Bloedspoor gecentreerd op de VOP-markering.</li>
                    <li>Spoor 3: Glasfragmenten van een defecte koplamp (rechterzijde).</li>
                </ul>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="space-y-4">
                    <div class="bg-slate-50 p-5 rounded-2xl border-2 border-slate-100 font-bold text-[11px] text-slate-500">
                        <p class="text-blue-900 uppercase font-black mb-3">Instructies:</p>
                        <p class="mb-2">1. Noteer feiten in redenen van wetenschap.</p>
                        <p class="mb-2">2. Benoem het strafbare feit.</p>
                        <p class="mb-2">3. Beschrijf decor en sporen PD.</p>
                        <p>4. Leg uit hoe je de sporen hebt veiliggesteld.</p>
                    </div>
                </div>
                <div class="flex flex-col">
                    <textarea id="pvInput" class="w-full flex-grow border-2 border-slate-200 p-6 rounded-2xl text-sm min-h-[400px] outline-none focus:border-police shadow-inner font-mono" placeholder="Begin uw PV hier..."></textarea>
                    <button onclick="sendData('PV Bevindingen', 'pvInput')" class="mt-4 bg-police text-white py-4 rounded-xl font-black uppercase text-xs italic tracking-widest shadow-xl">Verstuur definitief PV</button>
                </div>
            </div>
        </section>

        <section>
            <h2 class="text-center font-black uppercase text-xs text-slate-400 mb-6 tracking-widest italic">Live Feed - Ingezonden Werk</h2>
            <div id="liveFeed" class="max-w-3xl mx-auto"></div>
        </section>

    </div>

</body>
</html>
